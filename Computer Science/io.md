## 프로그램 입출력
프로그램 입출력은 말 그대로 프로그램 속 명령어로 입출력 장치를 제어하는 방법입니다. 보다 정확하게는 입출력 장치에 연결 된 장치 컨트롤러를 프로그램 명령어로 제어하는 방법이라고 할 수 있습니다.

간단한 예를 통해, 프로그램 입출력을 통해 장치 컨트롤러와 어떻게 상호작용하는지 알아보겠습니다.   
메모리에 저장된 정보를 하드 디스크에 백업(쓰기)을 하는 작업은 아래와 같이 작동합니다.

1. CPU는 하드 디스크 컨트롤러의 제어 레지스터에 쓰기 명령 내보내기

2. 하드 디스크 컨트롤러는 하드 디스크 상태를 확인하고, 가능하다면 상태 레지스터에 준비 완료 표시

3. CPU는 상태 레지스터를 주기적으로 읽어보며 하드 디스크 준비 여부 확인

4. 하드 디스크가 준비되었다면, 백업할 메모리의 정보를 데이터 레지스터에 쓰기

    4-1. 백업 작업이 끝나지 않았다면 1번 부터 반복작업

입출력 장치는 다양한 입출력 장치가 있기 때문에 규격화하기 어렵다는 단점이 있었는데 CPU는 어떻게 장치 컨트롤러의 적절한 레지스터 값을 알 수 있을까요?

이 문제를 해결하기 위해 2가지 입출력 방식이 있습니다. 첫 번째, 메모리 맵 입출력 방식이 있고 두 번째로 고립형 입출력 방식이 있습니다. 프로그램 입출력 방식은 CPU가 장치 컨트롤러의 레지스터 값을 읽고 씀으로 이루어지는데, 이 장치 컨트롤러의 레지스터를 알기 위한 방법입니다.

#### 메모리 맵 입출력

메모리에 접근하기 위한 주소 공간과 입출력 장치에 접근하기 위한 주소 공간을 하나의 주소 공간으로 간주하는 방법입니다. 메모리에 접근하는 명령어와 입출력 장치의 접근하는 명령어가 동일한 구조를 가지는 방법입니다.

#### 고립형 방식

메모리를 위한 주소 공간과 입출력 장치를 위한 주소 공간을 분리하는 방법입니다. 제어 버스에 입출력 장치 버스를 따로 둠으로 메모리에 접근하는 것과 입출력 장치에 접근하는 통로를 따로 두고 입출력 전용 명령어를 사용하는 방식입니다.


## 인터럽트 기반 입출력
하드웨어 인터럽트는 입출력장치가 발생시킨다고 했지만 더 정확하게는 장치 컨트롤러에 의해 발생합니다.

일반적으로 사용되는 입출력장치가 많기 때문에 동시다발적인 인터럽트를 발생합니다. CPU는 동시에 많은 인터럽트 신호가 발생하게 되면 단순하게 신호가 발생한 순서대로 처리할 수 있습니다. 하지만 인터럽트 중에서도 우선순위가 존재하기 때문에 모든 인터럽트를 순차적으로 처리할 수 없습니다. 예를 들어, 인터럽트 시간에 배웠던 NMI(Non Maskable Interrupt)가 발생하게 되면 첫번째 인터럽트가 실행중이더라도 이 인터럽트를 중지하고 NMI를 실행하게 됩니다.

이처럼 우선순위를 반영한 인터럽트를 처리하는 방법으로 PIC(Programmable Interrupt Controller)를 사용합니다. PIC는 여러 장치 컨트롤러에 연결되어 장치 컨트롤러가 발생한 하드웨어 인터럽트의 우선순위를 판단한 뒤 CPU에게 지금 처리해야 하는 인터럽트가 무엇인지 알려주게 됩니다. NMI는 보통 바로 CPU에 전달되기 때문에 PIC로 판단되지는 않습니다.

## DMA 입출력
프로그램과 인터럽트 기반 입출력의 공통점은 CPU가 주도하여 데이터도 반드시 CPU를 거치는 특징이 있습니다. 바쁜 CPU는 입출력장치 연산을 위해 많은 시간을 빼앗길 수 있습니다. 가령 대용량 데이터를 백업할 경우 그 시간은 무시할 수 없을 것 입니다. 이런 상황을 해결하기 위해 DMA(Direct Memory Access) 기능이 나왔습니다. DMA는 CPU를 거치지 않고 입출력장치가 메모리에 직접적으로 접근할 수 있으며 이 작업을 위해 DMA 컨트롤러가 추가적으로 필요합니다.

1. CPU는 DMA 컨트롤러에 입출력 작업을 명령

2. DMA 컨트롤러는 CPU 대신 장치 컨트롤러와 상호작용하여 입출력 작업 수행. 이때 필요하다면 메모리에 직접 접근

3. 입출력 작업이 끝나면 DMA 컨트롤러는 CPU에게 완료 인터럽트 발생

4. 결국 CPU는 입출력 작업의 시작과 끝만 존재

여기서 DMA 컨트롤러가 메모리에 직접 접근하는 과정에서 시스템 버스를 사용하게 됩니다. 하지만 시스템 버스는 공용 자원이기 때문에 동시 사용이 불가능합니다. 결국 CPU가 이용하고 있다면 DMA 컨트롤러는 사용할 수 없습니다. 따라서 DMA 컨트롤러는 2가지 방식으로 시스템 버스를 이용하게 됩니다.

1. CPU가 시스템 버스를 이용하지 않을 때마다 조금씩 시스템 버스 이용

2. CPU가 일시적으로 시스템 버스를 이용하지 않도록 허락을 구하고 시스템 버스 이용

이때, 장치컨트롤러들도 시스템버스에 직접 연결이 되어 있다면 DMA 컨트롤러는 시스템 버스 사용을 2번 해야 합니다. 예를 들어, 메모리의 데이터를 하드디스크로 백업하는 작업을 한다면 데이터를 메모리에서 DMA 컨트롤러로 이동시킬때와 DMA 컨트롤러에서 장치 컨트롤러로 이동시킬때 이용하게 됩니다. 앞서 말한것 처럼 시스템 버스는 공유 자원이기 때문에 누군가가 점유하는 상황은 좋은 상황이 아니기 때문에 장치 컨트롤러는 시스템 버스가 아닌 입출력 버스에 연결되어 DMA 컨트롤러가 시스템 버스에 불필요한 접근을 막아줍니다.